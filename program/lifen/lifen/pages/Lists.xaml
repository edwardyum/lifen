<Page
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:lifen"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:Custom="using:Microsoft.UI.Xaml.Controls"
    x:Class="lifen.BlankPage1"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.DataContext>
        <local:ListsViewModel/>
    </Page.DataContext>

    <RelativePanel>
        <StackPanel x:Name="Projects" DataContext="{Binding root, UpdateSourceTrigger=PropertyChanged}" Orientation="Horizontal" Height="500">
            <ItemsControl ItemsSource="{Binding subtasks, UpdateSourceTrigger=PropertyChanged}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        
                        <RelativePanel Width="152">
                            <TextBox x:Name="ProjectName" TextWrapping="Wrap" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="150">
                                <TextBox.ContextFlyout>
                                    <MenuFlyout>
                                        <MenuFlyoutItem Text="удалить проект" Command="{Binding delete_task_command, UpdateSourceTrigger=PropertyChanged}"/>
                                    </MenuFlyout>
                                </TextBox.ContextFlyout>
                            </TextBox>

                            <StackPanel x:Name="TasksList" RelativePanel.Below="ProjectName" >
                                <ItemsControl ItemsSource="{Binding subtasks}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Vertical"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            
                                            <RelativePanel Height="70">
                                                <TextBox x:Name="TaskName" TextWrapping="NoWrap" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged }" Width="150"/>
                                                <CheckBox x:Name="Done" IsChecked="{Binding Done, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" RelativePanel.Below="TaskName" Width="10"/>
                                                <Button x:Name="AddToday" Content="сегодня" Command="{Binding add_task_for_today_command}" RelativePanel.Below="TaskName" HorizontalAlignment="Left" Margin="27,0,0,0" Height="30" Width="60"/>
                                                <DropDownButton Name="SubTasks" RelativePanel.Below="TaskName" RelativePanel.AlignRightWith="TaskName" Height="30" Width="47" CornerRadius="5">
                                                    <DropDownButton.Flyout>
                                                        <Flyout>
                                                            
                                                            <RelativePanel >
                                                                <StackPanel x:Name="ListSubtask">
                                                                    <ItemsControl ItemsSource="{Binding subtasks}">
                                                                    <ItemsControl.ItemTemplate>
                                                                        <DataTemplate>
                                                                            <RelativePanel>
                                                                                <CheckBox x:Name="Done" Content="CheckBox" IsChecked="{Binding Done, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                                                <TextBox x:Name="SubtaskName" TextWrapping="Wrap" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" RelativePanel.RightOf="Done"/>
                                                                                <Button x:Name="AddToday" Content="на сегодня" Command="{Binding add_task_for_today_command}"  RelativePanel.RightOf="SubtaskName" Height="50" Width="100"/>
                                                                                <RelativePanel.ContextFlyout>
                                                                                    <MenuFlyout>
                                                                                        <MenuFlyoutItem Text="удалить" Command="{Binding delete_task_command, UpdateSourceTrigger=PropertyChanged}"/>
                                                                                    </MenuFlyout>
                                                                                </RelativePanel.ContextFlyout>
                                                                            </RelativePanel>                                                                        
                                                                        </DataTemplate>
                                                                    </ItemsControl.ItemTemplate>
                                                                    </ItemsControl>
                                                                </StackPanel>
                                                                <Button Content="новая подзадача" Command="{Binding add_task_command}" RelativePanel.Below="ListSubtask" Height="50" Width="100"/>
                                                            </RelativePanel>
                                                            
                                                        </Flyout>
                                                    </DropDownButton.Flyout>
                                                </DropDownButton>
                                                <RelativePanel.ContextFlyout>
                                                    <MenuFlyout>
                                                        <MenuFlyoutItem Text="удалить" Command="{Binding delete_task_command, UpdateSourceTrigger=PropertyChanged}"/>
                                                    </MenuFlyout>
                                                </RelativePanel.ContextFlyout>
                                            </RelativePanel>

                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                            <Button Content="новая задача" Command="{Binding add_task_command}" RelativePanel.Below="TasksList" Height="30" Width="100"/>
                            
                        </RelativePanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>

        <Button Content="новый проект" Command="{Binding root.add_task_command}" RelativePanel.RightOf="Projects" Height="50" Width="100"/>

        <StackPanel x:Name="Today" DataContext="{Binding today, UpdateSourceTrigger=PropertyChanged}" Orientation="Horizontal" RelativePanel.Below="Projects" Margin="200,0,0,0" Height="500">
            <ItemsControl ItemsSource="{Binding subtasks}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>

                        <RelativePanel>
                            <TextBox x:Name="ProjectName" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap"/>

                            <StackPanel x:Name="TasksList" RelativePanel.Below="ProjectName">
                                <ItemsControl ItemsSource="{Binding subtasks}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Vertical"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>

                                            <RelativePanel>
                                                <TextBox x:Name="TaskName" TextWrapping="Wrap" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                <CheckBox x:Name="Done" Content="CheckBox" IsChecked="{Binding Done, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" RelativePanel.Below="TaskName"/>
                                                
                                                <DropDownButton Name="SubTasks" RelativePanel.Below="TaskName" RelativePanel.RightOf="Done">
                                                    <DropDownButton.Flyout>
                                                        <Flyout>

                                                            <RelativePanel >
                                                                <StackPanel x:Name="ListSubtask">
                                                                    <ItemsControl ItemsSource="{Binding subtasks}">
                                                                        <ItemsControl.ItemTemplate>
                                                                            <DataTemplate>
                                                                                <RelativePanel>
                                                                                    <CheckBox x:Name="Done" Content="CheckBox" IsChecked="{Binding Done, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                                                    <TextBox x:Name="SubtaskName" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap" RelativePanel.RightOf="Done"/>

                                                                                </RelativePanel>
                                                                            </DataTemplate>
                                                                        </ItemsControl.ItemTemplate>
                                                                    </ItemsControl>
                                                                </StackPanel>
                                                                <RelativePanel.ContextFlyout>
                                                                    <MenuFlyout>
                                                                        <MenuFlyoutItem Text="удалить" Command="{Binding delete_task_from_today_command, UpdateSourceTrigger=PropertyChanged}"/>
                                                                    </MenuFlyout>
                                                                </RelativePanel.ContextFlyout>
                                                            </RelativePanel>

                                                        </Flyout>
                                                    </DropDownButton.Flyout>
                                                </DropDownButton>
                                                <RelativePanel.ContextFlyout>
                                                    <MenuFlyout>
                                                        <MenuFlyoutItem Text="удалить" Command="{Binding delete_task_from_today_command, UpdateSourceTrigger=PropertyChanged}"/>
                                                    </MenuFlyout>
                                                </RelativePanel.ContextFlyout>
                                            </RelativePanel>

                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                        </RelativePanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
        


    </RelativePanel>
    
</Page>
